(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{423:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_21、webpack和eslint的结合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_21、webpack和eslint的结合"}},[t._v("#")]),t._v(" 21、webpack和ESLint的结合")]),t._v(" "),a("h3",{attrs:{id:"_1-行业里面优秀的eslint规范实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-行业里面优秀的eslint规范实践"}},[t._v("#")]),t._v(" 1）行业里面优秀的ESLint规范实践")]),t._v(" "),a("blockquote",[a("p",[t._v("AirBnb：eslint-config-airbnb、eslint-config-airbnb-base\n腾讯：alloyteam团队（eslint-config-alloy）\nivweb团队（eslint-config-ivweb）")])]),t._v(" "),a("h3",{attrs:{id:"_2-制定团队的eslint规范遵循的原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-制定团队的eslint规范遵循的原则"}},[t._v("#")]),t._v(" 2）制定团队的ESLint规范遵循的原则")]),t._v(" "),a("ul",[a("li",[t._v("不重复造轮子，基于eslint：recommend配置并改进")]),t._v(" "),a("li",[t._v("能够帮助发现代码错误的规则，全部开启")]),t._v(" "),a("li",[t._v("帮助保持团队的代码风格统一，而不限制开发体验")])]),t._v(" "),a("h3",{attrs:{id:"_3-eslint如何落地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-eslint如何落地"}},[t._v("#")]),t._v(" 3）ESLint如何落地")]),t._v(" "),a("h4",{attrs:{id:"_1-和ci-cd系统集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-和ci-cd系统集成"}},[t._v("#")]),t._v(" （1）和CI / CD系统集成")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/ZUD6NE8JWAcfnbKj.png!thumbnail?fileGuid=cgpdTqWJ6kyXpVWx",alt:"图片"}})]),t._v(" "),a("p",[t._v("本地开发阶段增加 precommit 钩子，安装 husky")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install husky "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dev\n")])])]),a("p",[t._v("增加npm script，通过lint-staged增量检查修改的文件\n"),a("img",{attrs:{src:"https://uploader.shimo.im/f/d0agZwneUmi6R8Ew.png!thumbnail?fileGuid=cgpdTqWJ6kyXpVWx",alt:"图片"}})]),t._v(" "),a("h4",{attrs:{id:"_2-和webpack集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-和webpack集成"}},[t._v("#")]),t._v(" （2）和webpack集成")]),t._v(" "),a("blockquote",[a("p",[t._v("比较推荐一些新的项目；使用eslint-loader，构建时检查JS规范。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/PpYtfUpSDT3kjnqH.png!thumbnail?fileGuid=cgpdTqWJ6kyXpVWx",alt:"图片"}})]),t._v(" "),a("h3",{attrs:{id:"_4-实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-实战"}},[t._v("#")]),t._v(" 4）实战")]),t._v(" "),a("p",[t._v("练习使用airbnb的eslint规范：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm i eslint"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" eslint"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("react eslint"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jsx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a11y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n")])])]),a("p",[t._v("安装eslint的loader")]),t._v(" "),a("div",{staticClass:"language-plain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i eslint-loader -D\n")])])]),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/WY9qWTaZDlmfZ0yD.png!thumbnail?fileGuid=cgpdTqWJ6kyXpVWx",alt:"图片"}})]),t._v(" "),a("h2",{attrs:{id:"_22、提取页面公共资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22、提取页面公共资源"}},[t._v("#")]),t._v(" 22、提取页面公共资源")]),t._v(" "),a("h3",{attrs:{id:"_1-基础库分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础库分离"}},[t._v("#")]),t._v(" 1）基础库分离")]),t._v(" "),a("blockquote",[a("p",[t._v("思路：将 react、react-dom 基础包通过 cdn 引⼊，不打⼊ bundle 中\n⽅法：使⽤ html-webpack-externals-plugin")])]),t._v(" "),a("p",[t._v("安装插件")]),t._v(" "),a("div",{staticClass:"language-plain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cnpm i html-webpack-externals-plugin -D\n")])])]),a("h4",{attrs:{id:"_1-不分离基础包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-不分离基础包"}},[t._v("#")]),t._v(" （1）不分离基础包")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/uQmuoOIEoW3yo0Rt.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h4",{attrs:{id:"_2-分离基础包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-分离基础包"}},[t._v("#")]),t._v(" （2）分离基础包")]),t._v(" "),a("blockquote",[a("p",[t._v("分离之后业务代码js体积少了。")])]),t._v(" "),a("h5",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HtmlWebpackExternalsPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html-webpack-externals-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackExternalsPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      externals"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://11.url.cn/now/lib/16.2.0/react.min.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          global"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'React'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://11.url.cn/now/lib/16.2.0/react-dom.min.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          global"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ReactDom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h5",{attrs:{id:"效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#效果"}},[t._v("#")]),t._v(" 效果")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/61ISTCZW7lUBfJbv.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h5",{attrs:{id:"引入脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入脚本"}},[t._v("#")]),t._v(" 引入脚本")]),t._v(" "),a("p",[t._v("在search文件里的index.html添加，浏览器访问即可，不加脚本就会报错")]),t._v(" "),a("blockquote",[a("p",[t._v("UncaughtReferenceError:ReactDomisnot defined")])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    <%= require('raw-loader!./meta.html') %>\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%= require('raw-loader!babel-loader!../../node_modules/lib-flexible/flexible.js') %>"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://11.url.cn/now/lib/16.2.0/react.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://11.url.cn/now/lib/16.2.0/react-dom.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-利用-splitchunksplugin-进行公共脚本分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-利用-splitchunksplugin-进行公共脚本分离"}},[t._v("#")]),t._v(" 2）利⽤ SplitChunksPlugin 进⾏公共脚本分离")]),t._v(" "),a("p",[t._v("Webpack4 内置的，替代 CommonsChunkPlugin插件")]),t._v(" "),a("p",[t._v("chunks参数说明：")]),t._v(" "),a("ul",[a("li",[t._v("async 异步引⼊的库进⾏分离(默认)")]),t._v(" "),a("li",[t._v("initial同步引⼊的库进⾏分离")]),t._v(" "),a("li",[t._v("all 所有引⼊的库进⾏分离(推荐)")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optimization"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    splitChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      chunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  引入包")]),t._v("\n      minSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 抽离的公共包最小的大小，单位字节")]),t._v("\n      maxSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最大的大小")]),t._v("\n      minChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源使用的次数(在多个页面使用到)， 大于1， 最小使用次数")]),t._v("\n      maxAsyncRequests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 并发请求的数量")]),t._v("\n      maxInitialRequests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 入口文件做代码分割最多能分成3个js文件")]),t._v("\n      automaticNameMaxLength"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 自动自动命名最大长度")]),t._v("\n      automaticNameDelimiter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'~'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件生成时的连接符")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让cacheGroups里设置的名字有效")]),t._v("\n      cacheGroups"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当打包同步代码时,上面的参数生效")]),t._v("\n        vendors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("[\\\\/]node_modules[\\\\/]")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//检测引入的库是否在node_modlues目录下的")]),t._v("\n          priority"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//值越大,优先级越高.模块先打包到优先级高的组里")]),t._v("\n          filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vendors.js'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//把所有的库都打包到一个叫vendors.js的文件里")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          minChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上面有")]),t._v("\n          priority"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上面有")]),t._v("\n          reuseExistingChunk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果一个模块已经被打包过了,那么再打包时就忽略这个上模块")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-利用-splitchunksplugin-分离基础包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-利用-splitchunksplugin-分离基础包"}},[t._v("#")]),t._v(" 3）利⽤ SplitChunksPlugin 分离基础包")]),t._v(" "),a("h4",{attrs:{id:"_1-test-匹配出需要分离的包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-test-匹配出需要分离的包"}},[t._v("#")]),t._v(" （1）test:匹配出需要分离的包")]),t._v(" "),a("h4",{attrs:{id:"_2-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置"}},[t._v("#")]),t._v(" （2）配置")]),t._v(" "),a("p",[t._v("去掉"),a("code",[t._v("html-webpack-externals-plugin")]),t._v("的配置以及index.html里面脚本的引用")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optimization"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    splitChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      cacheGroups"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        commons"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("(react|react-dom)")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vendors'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          chunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("打包效果\n"),a("img",{attrs:{src:"https://uploader.shimo.im/f/mV9Z6cb2ftWtclpu.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("查看"),a("code",[t._v("vendors")]),t._v("文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/0ImHM6ewa8a85L91.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h3",{attrs:{id:"_4-利用splitchunksplugin分离⻚面公共文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-利用splitchunksplugin分离⻚面公共文件"}},[t._v("#")]),t._v(" 4）利⽤SplitChunksPlugin分离⻚⾯公共⽂件")]),t._v(" "),a("ul",[a("li",[t._v("minChunks:设置最⼩引⽤次数为2次")]),t._v(" "),a("li",[t._v("minSize:分离的包体积的⼤⼩")])]),t._v(" "),a("p",[t._v("配置")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optimization"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    splitChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      minSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cacheGroups"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          commons"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'commons'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            chunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            minChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"_1-在项目下新建文件夹common-里面添加index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-在项目下新建文件夹common-里面添加index-js"}},[t._v("#")]),t._v(" （1）在项目下新建文件夹"),a("code",[t._v("common")]),t._v("，里面添加index.js")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("common")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common module'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"_2-然后search-以及index页面的index-js引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-然后search-以及index页面的index-js引用"}},[t._v("#")]),t._v(" （2）然后search，以及index页面的index.js引用")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../common/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"_3-效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-效果"}},[t._v("#")]),t._v(" （3）效果")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/nC3f6MfjDaGsnNNb.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h4",{attrs:{id:"_4-common-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-common-js"}},[t._v("#")]),t._v(" （4）common.js")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webpackJsonp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webpackJsonp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"_5-也可以改变一下minsize-minchunks的值看看能否打包出来common-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-也可以改变一下minsize-minchunks的值看看能否打包出来common-js"}},[t._v("#")]),t._v(" （5）也可以改变一下minSize，minChunks的值看看能否打包出来common.js")]),t._v(" "),a("h2",{attrs:{id:"_23、tree-shaking-摇树优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23、tree-shaking-摇树优化"}},[t._v("#")]),t._v(" 23、tree shaking(摇树优化)")]),t._v(" "),a("h3",{attrs:{id:"_1-tree-shaking概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-tree-shaking概念"}},[t._v("#")]),t._v(" 1）tree shaking概念")]),t._v(" "),a("p",[t._v("形象化释义：一棵树，不断地摇晃，那些死掉的、没用的叶子就会被摇下来过滤掉，剩下的就是有生机的、有用的部分。")]),t._v(" "),a("blockquote",[a("p",[t._v("概念：1个模块可能有多个方法，只要其中的某个方法使用到了，则整个文件都会被打倒bundle里面去。tree shaking就是只把用到的方法打入到bundle，没用到的方法会在uglify阶段被擦除掉。\n使用：Webpack4 默认支持，在 .babelrc 里面设置 modules: false 即可，production mode的情况下默认开启，mode设置成none就不开启tree shaking。\n要求：必须是ES6语法，CJS的方式不支持。")])]),t._v(" "),a("p",[t._v("要了解tree shaking的原理，首先要理解一个概念DCE（Elimination），通常有三种情况：")]),t._v(" "),a("ul",[a("li",[t._v("代码不会被执行，不可到达")]),t._v(" "),a("li",[t._v("代码执行的结果不会被用到")]),t._v(" "),a("li",[t._v("代码只会影响死变量（只写不读）")])]),t._v(" "),a("p",[t._v("类似：")]),t._v(" "),a("div",{staticClass:"language-plain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("if (false) {\n  console.log('这段代码永远不会执行！');\n}\n")])])]),a("p",[t._v("tree shaking就是利用到了这三点，从而分析哪些代码是需要被删除掉的。")]),t._v(" "),a("h3",{attrs:{id:"_2-tree-shaking原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-tree-shaking原理"}},[t._v("#")]),t._v(" 2）tree shaking原理")]),t._v(" "),a("p",[t._v("利用ES6模块的特点：")]),t._v(" "),a("ul",[a("li",[t._v("只能作为模块顶层的语句出现")]),t._v(" "),a("li",[t._v("import的模块名只能是字符串常量")]),t._v(" "),a("li",[t._v("import binding是immutable的")])]),t._v(" "),a("p",[t._v("代码擦除：uglify阶段删除无用代码")]),t._v(" "),a("h3",{attrs:{id:"_3-实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-实战"}},[t._v("#")]),t._v(" 3）实战")]),t._v(" "),a("h4",{attrs:{id:"_1-不使用tree-shaking的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-不使用tree-shaking的情况"}},[t._v("#")]),t._v(" （1）不使用tree shaking的情况")]),t._v(" "),a("p",[t._v("先在search文件中新建一个tree-shaking.js，然后在里面加入两个可以导出的函数：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/X1Tarvn14iDJD7Nl.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("在index.js中引入a，但不用它，而不引入b：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/5liE3sBg6gdg3wK6.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("同时将mode设置为none（默认不使用tree shaking）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/Fy5DBNqQ00brlPDm.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("重新构建项目，发现这两个没用的函数都被打进去了：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/vHNEWh1T7AbBAqCG.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h4",{attrs:{id:"_2-使用tree-shaking后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用tree-shaking后"}},[t._v("#")]),t._v(" （2）使用tree shaking后")]),t._v(" "),a("p",[t._v("开启tree shaking，mode设置为production：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/Q9BDibB63UrcDCSt.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("重新构建项目：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/25vZbe1wInnktyJl.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("会发现，这两个方法都搜不到了，意味着没有被打入包里面：")]),t._v(" "),a("p",[t._v("如果我们调用一下这个a方法，再重新打包，会发现a方法被打入到了包里面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/qCZrpHTx13w1SjXE.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("blockquote",[a("p",[t._v("但是需要注意的是：如果方法里面有副作用，tree shaking就会失效；")])]),t._v(" "),a("h2",{attrs:{id:"_24、scopehoisting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24、scopehoisting"}},[t._v("#")]),t._v(" 24、ScopeHoisting")]),t._v(" "),a("h3",{attrs:{id:"_1-使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用场景"}},[t._v("#")]),t._v(" 1）使用场景")]),t._v(" "),a("p",[t._v("现象：构建后的代码存在大量的闭包代码")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/jd3KiottPc8WuN1h.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("问题：大量函数闭包包裹代码，导致体积增大（模块越多越明显），运行代码时创建的函数作用域变多，内存开销变大。")]),t._v(" "),a("h3",{attrs:{id:"_2-模块转换分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-模块转换分析"}},[t._v("#")]),t._v(" 2）模块转换分析")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/P5gr00VVKsfFnrI2.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("p",[t._v("结论：")]),t._v(" "),a("ul",[a("li",[t._v("被 webpack 转换后的模块会带上一层包裹")]),t._v(" "),a("li",[t._v("import 会被转换成__webpack_require")])]),t._v(" "),a("h3",{attrs:{id:"_3-进一步分析-webpack-的模块机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-进一步分析-webpack-的模块机制"}},[t._v("#")]),t._v(" 3）进一步分析 webpack 的模块机制")]),t._v(" "),a("p",[t._v("分析：")]),t._v(" "),a("ul",[a("li",[t._v("打包出来的是一个IIFE（匿名闭包）")]),t._v(" "),a("li",[t._v("modules 是一个数组，每一项是一个模块初始化函数")]),t._v(" "),a("li",[t._v("__webpack_require 用来加载模块，返回module.exports")]),t._v(" "),a("li",[t._v("通过 WEBPACK_REQUIRE_METHOD(0) 启动程序")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/1Usr2BEt3nE1QNXM.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h3",{attrs:{id:"_4-scope-hoisting-原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-scope-hoisting-原理"}},[t._v("#")]),t._v(" 4）scope hoisting 原理")]),t._v(" "),a("blockquote",[a("p",[t._v("原理：将所有模块的代码按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止变量名冲突。\n对比：通过scope hoisting 可以减少函数声明代码和内存开销")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/NzW6mgP16p1bW8vz.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})]),t._v(" "),a("h3",{attrs:{id:"_5-scope-hoisting使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-scope-hoisting使用"}},[t._v("#")]),t._v(" 5）scope hoisting使用")]),t._v(" "),a("p",[t._v("webpack mode 为production默认开启，必须是ES6语法，CJS不支持。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://uploader.shimo.im/f/m11dNDEgxcpe9Zjv.png!thumbnail?fileGuid=hcxyRQkrHpYxyKtC",alt:"图片"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);